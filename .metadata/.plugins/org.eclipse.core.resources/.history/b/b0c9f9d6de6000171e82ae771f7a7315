package javaEail.until;

import java.util.Properties;

import javax.mail.Address;
import javax.mail.Message;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import javax.mail.internet.MimeMessage.RecipientType;

import com.sun.mail.util.MailSSLSocketFactory;

/**邮件的工具类*/
public class EmailUntil {

	/**将发件人的Email地址传进去,以及UUD传入,完成验证*/
	public static void sendEmail(String to ,String code) {
		
		try {
			//创建连接对象
			//创建配置服务信息
			//QQ邮箱的令牌  lulyxaugngsfhhad
			Properties props = new Properties();
			// 开启debug调试
			props.setProperty("mail.debug", "true");
			// 发送服务器需要身份验证
			props.setProperty("mail.smtp.auth", "true");
			// 设置邮件服务器主机名
			props.setProperty("mail.host", "smtp.qq.com");
			// 发送邮件协议名称
			props.setProperty("mail.transport.protocol", "smtp");
			
			//SSH加密协议
		    MailSSLSocketFactory sf = new MailSSLSocketFactory();
		    sf.setTrustAllHosts(true);
		    props.put("mail.smtp.ssl.enable", "true");
		    props.put("mail.smtp.ssl.socketFactory", sf);
		    
			Session session = Session.getInstance(props);
			//创建邮件对象
			Message message = new MimeMessage(session);
			message.setFrom(new InternetAddress("1434501783@qq.com"));			//发件人
			message.setRecipient(RecipientType.TO, new InternetAddress(to));	//发送类型,收件人	
			message.setSubject("主题:这是我的JAVA测试邮件");							//设置邮件主题
			String html = "	<h1>晚上好</hi><p>当你收到这封信的时候证明我已成功地通过JAVA使用QQ邮箱服务向您发送了该邮件</p>"
						+ "<p>小梅梅不要难受了,每一个选择都是一次新的尝试,就像我,从动科转到机械,再从机械转到软件,每一次抉择都会难受很多.</br>"
						+ "记得刚刚从动科学院转机电学院的时候,面对周围不认识的新同学心里总会有很多孤落.尤其是在他们一个宿舍一个宿舍在一起的时候,只剩我一个,每次实验或者上机的时候都会很难受."
						+ "这种感觉就好像是自己完全不属于这里一样.有时候也会难受,后悔自己为什么跳进来,不好好在动科呆着(动科考研很容易的,相对而言机电就要难很多,大三特别后悔这个)后来也就释然了,"
						+ "因为我知道,就算我在动科呆着,心里也会不甘心,为什么不能做自己想做的事情</p>."
						+ "<p>我有写日记的习惯,每一学期都是,人家都说写日记的孩子清楚自己想要什么,翻到过大一的日记,当时的自己很有志气,想着发明创造些什么,然后在动科给不了我想要的,局限在短短框框中让我很难受,"
						+ "也许是觉得自己更适合机械类,不愿意继续在温水煮青蛙的日子中混下去,我申请转系,来到了全校挂科率最高的机电学院.自己还满怀信心地给自己的大学定下了四个职业方向:机械设计,电气控制,软件编程,"
						+ "人民教师(其实我一直觉得自己挺有教学生的天赋的),后来的日子我就在这样的安排下学习了.结果,结果就是我由于自己过于孤落,剩下了更多的时间去做更多自己喜欢的事情,认识更多更有趣的人.大概就是"
						+ "<b>孤独成就人生吧</b></p>"
						+ "<p>其实我挺羡慕你的,很努力,人又漂亮.每天都有很多挑战可以做,都有很多人在逼着你学习,虽然这个过程是困难的,但是收获总是会有的,<b>相信你回来会笑着把这段让你哭的经历说出来</b></p>";
			
//			String html = "	<h1>你好,很高兴认识你</hi><p>您的UUID为:"+code+"</p>";		//设置邮件内容
			message.setContent(html, "text/html;charset=UTF-8");				//设置邮件文本格式
			
		//发送邮件
			Transport transport = session.getTransport();
	        transport.connect("smtp.qq.com", "1434501783@qq.com", "lulyxaugngsfhhad");					//获取连接(连接方式,发送人邮箱,发送人密码)
	        transport.sendMessage(message, new Address[] { new InternetAddress(to) });	//以列表形式发送邮件.群发
	        transport.close();
		} catch (Exception e) {
			System.err.println("创建邮件服务发生意外.....");
			e.printStackTrace();
		}
		
		
	}
}
